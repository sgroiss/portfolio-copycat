---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import Project from "../components/Project.astro";
import { getCollection } from "astro:content";

const allProjects = await getCollection("projects");
// optional sortieren nach "order"
const projects = allProjects
  .filter((entry) => entry.data.featured !== false)
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));
---

<Layout title="Simon Groiss">
  <main class="flex-1">
    <Hero />

    <section
      id="projects"
      data-overlap-previous
      data-overlap-speed="0.6"
      class="bg-sg-black flex flex-col"
    >
      <div class="container mx-auto text-white py-16">
        <div class="flex justify-between items-baseline w-full mb-16">
          <h2 class="text-5xl">Projects</h2>
          <a href="#" class="text-white underline text-lg">View all</a>
        </div>

        <div class="work-grid">
          {
            projects.map((entry, index) => {
              const isWide = (index + 1) % 3 === 0; // jedes 3. Projekt = breit
              const wideIndex = Math.floor((index + 1) / 3); // 1,2,3,...
              const alignRight = isWide && wideIndex % 2 === 0;

              const itemClass = [
                "work-item",
                isWide
                  ? alignRight
                    ? "work-item--wide-right"
                    : "work-item--wide-left"
                  : "",
              ]
                .filter(Boolean)
                .join(" ");

              return (
                <div class={itemClass}>
                  <a
                    href={`/projects/${entry.slug}`}
                    class="block group js-project-link"
                    data-project-id={entry.slug}
                    data-project-title={entry.data.title}
                    data-overlay-color={entry.data.overlayColor}
                  >
                    <Project
                      id={entry.slug}
                      title={entry.data.title}
                      desc={entry.data.desc}
                      img={entry.data.img}
                      overlayColor={entry.data.overlayColor}
                    />
                  </a>
                </div>
              );
            })
          }
        </div>
      </div>
    </section>
  </main>
</Layout>

<script>
  import "../scripts/main.js";
  import "../scripts/project-transition.js";
</script>
